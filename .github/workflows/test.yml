name: CI

on:
    pull_request:
        branches:
            - main
        paths:
            - 'complete.json'
            - 'scripts/**'
            - '.github/workflows/**'
    workflow_dispatch:

jobs:
    Test:
        runs-on: ubuntu-latest
        
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
            
            - name: Set up Ruby
              uses: ruby/setup-ruby@v1
              with:
                  ruby-version: '3.2'
                  bundler-cache: true
            
            - name: Run processing script (dry run)
              run: |
                  ruby scripts/process.rb --dry-run
            
            - name: Verify complete.json is valid
              run: |
                  ruby -rjson -e "JSON.parse(File.read('complete.json')); puts '✓ complete.json is valid JSON'"
            
            - name: Test summary
              run: |
                  echo "✓ All tests passed!"
                  echo "✓ Processing scripts executed successfully in dry-run mode"
                  echo "✓ No files were modified"